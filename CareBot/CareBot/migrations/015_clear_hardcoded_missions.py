"""
Migration 015: –û—á–∏—Å—Ç–∏—Ç—å –º–∏—Å—Å–∏–∏ —Å hardcoded cell=2

–ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –º–∏—Å—Å–∏–∏ –≤ –±–∞–∑–µ –∏–º–µ–ª–∏ hardcoded cell=2
–≠—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –∏–≥—Ä–æ–≤–æ–π –¥–∏–∑–∞–π–Ω - –∫–∞–∂–¥–∞—è –º–∏—Å—Å–∏—è –¥–æ–ª–∂–Ω–∞ –Ω–∞–∑–Ω–∞—á–∞—Ç—å—Å—è –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∫–ª–µ—Ç–∫—É
–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã—Ö –≥–µ–∫—Å–∞—Ö –∞–ª—å—è–Ω—Å–æ–≤.

–†–µ—à–µ–Ω–∏–µ: 
- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∏—Å—Å–∏–∏ (locked=1) —Å hardcoded cell=2
- –û—Å—Ç–∞–≤–∏—Ç—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ (locked=0) –∏–ª–∏ –º–∏—Å—Å–∏–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ cellÂÄº
- –ù–æ–≤—ã–µ –º–∏—Å—Å–∏–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã —Å cell=None –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
"""
from yoyo import step


def clear_hardcoded_missions(conn):
    """–û—á–∏—Å—Ç–∏—Ç—å –º–∏—Å—Å–∏–∏ —Å hardcoded cell=2"""
    cursor = conn.cursor()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ç–∞–±–ª–∏—Ü—ã mission_stack
    cursor.execute("SELECT name FROM sqlite_master WHERE type='table' AND name='mission_stack'")
    if not cursor.fetchone():
        print("‚úÖ –¢–∞–±–ª–∏—Ü–∞ mission_stack –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –Ω–∏—á–µ–≥–æ –Ω–µ –Ω—É–∂–Ω–æ —á–∏—Å—Ç–∏—Ç—å")
        return
    
    # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∏—Å—Å–∏—è—Ö –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º
    cursor.execute("""
        SELECT COUNT(*) FROM mission_stack 
        WHERE locked=1 AND cell=2 AND rules IN ('Onlu War', 'killteam')
    """)
    count = cursor.fetchone()[0]
    
    if count > 0:
        print(f"üßπ –£–¥–∞–ª—è–µ–º {count} –º–∏—Å—Å–∏–π —Å hardcoded cell=2 (locked=1)...")
        
        # –£–¥–∞–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ù–´–ï –º–∏—Å—Å–∏–∏ (locked=1) —Å cell=2
        # –≠—Ç–æ —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã
        cursor.execute("""
            DELETE FROM mission_stack 
            WHERE locked=1 AND cell=2
        """)
        
        print(f"‚úÖ –£–¥–∞–ª–µ–Ω–æ {cursor.rowcount} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∏—Å—Å–∏–π")
    else:
        print("‚úÖ –ù–µ—Ç –º–∏—Å—Å–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è - –±–∞–∑–∞ —á–∏—Å—Ç–∞—è")
    
    # –£–±–µ–¥–∏–º—Å—è —á—Ç–æ —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∏—Å—Å–∏–∏ (locked=0) –æ—Å—Ç–∞–ª–∏—Å—å
    cursor.execute("SELECT COUNT(*) FROM mission_stack WHERE locked=0")
    unlocked_count = cursor.fetchone()[0]
    print(f"‚úÖ –û—Å—Ç–∞–ª–æ—Å—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∏—Å—Å–∏–π: {unlocked_count}")
    
    # –£–±–µ–¥–∏–º—Å—è —á—Ç–æ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–∏—Å—Å–∏–∏ –æ—Å—Ç–∞–ª–∏—Å—å –Ω–µ—Ç—Ä–æ–Ω—É—Ç—ã–º–∏
    cursor.execute("SELECT COUNT(*) FROM mission_stack")
    total_count = cursor.fetchone()[0]
    print(f"‚úÖ –í—Å–µ–≥–æ –º–∏—Å—Å–∏–π –≤ –±–∞–∑–µ: {total_count}")


steps = [step(clear_hardcoded_missions)]
