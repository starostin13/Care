# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–µ–ø–ª–æ—è - Docker Compose v2

## –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ –Ω–∞ production:
```
KeyError: 'ContainerConfig' in docker-compose volume binding logic
```

## –ü—Ä–∏—á–∏–Ω–∞

- **Docker v28.5.1** (—Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)  
- **docker-compose v1.29.2** (legacy –≤–µ—Ä—Å–∏—è)
- **–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** –º–µ–∂–¥—É modern Docker –∏ legacy docker-compose

## –†–µ—à–µ–Ω–∏–µ

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Å–∫—Ä–∏–ø—Ç `update-production.ps1`

–ó–∞–º–µ–Ω–µ–Ω—ã –≤—Å–µ –≤—ã–∑–æ–≤—ã:
```powershell
# ‚ùå –°–¢–ê–†–û–ï (legacy v1.29.2)
docker-compose -f docker-compose.production.yml ...

# ‚úÖ –ù–û–í–û–ï (modern v2.40.0) 
docker compose -f docker-compose.production.yml ...
```

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö

1. **Update-Production()** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ rebuild + up
2. **Start-AdminMode()** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ admin —Ä–µ–∂–∏–º
3. **Stop-AdminMode()** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ admin
4. **Start-Service()** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–ø—É—Å–∫
5. **Stop-Service()** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞  
6. **Restart-Service()** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
7. **logs action** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏

### üìã –í–µ—Ä—Å–∏–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
ubuntu@192.168.1.125:~$ docker --version
Docker version 28.5.1, build e180ab8

ubuntu@192.168.1.125:~$ docker-compose --version  # Legacy
docker-compose version 1.29.2, build unknown

ubuntu@192.168.1.125:~$ docker compose version    # Modern
Docker Compose version v2.40.0
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã

```powershell
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
PS C:\> .\scripts\update-production.ps1 restart
SUCCESS: Service rebuilt and restarted

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
PS C:\> .\scripts\update-production.ps1 status  
SUCCESS: Service is healthy! Status: healthy

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
PS C:\> .\scripts\update-production.ps1 logs
‚úÖ –°–µ—Ä–≤–∏—Å –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –±–µ–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
```

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

- ‚úÖ **ContainerConfig –æ—à–∏–±–∫–∞ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∞**
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω—ã–µ rebuilds –æ–±—Ä–∞–∑–æ–≤**  
- ‚úÖ **–ù–∞–¥–µ–∂–Ω—ã–π restart —Å–µ—Ä–≤–∏—Å–æ–≤**
- ‚úÖ **–ó–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–∞ –≤ –Ω–æ—Ä–º–µ**

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

1. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç modern Docker Compose v2
2. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** - —É—Å—Ç—Ä–∞–Ω—è–µ—Ç legacy –ø—Ä–æ–±–ª–µ–º—ã
3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –±–æ–ª—å—à–µ –Ω–µ—Ç ContainerConfig –æ—à–∏–±–æ–∫
4. **–ë—É–¥—É—â–µ–µ** - –≥–æ—Ç–æ–≤ –∫ –Ω–æ–≤—ã–º –≤–µ—Ä—Å–∏—è–º Docker

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```powershell
# –ü–æ–ª–Ω—ã–π –¥–µ–ø–ª–æ–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π
.\scripts\update-production.ps1 update

# –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
.\scripts\update-production.ps1 restart

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
.\scripts\update-production.ps1 status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
.\scripts\update-production.ps1 logs
```

## üöÄ –ò—Ç–æ–≥

**Root cause –∏—Å–ø—Ä–∞–≤–ª–µ–Ω!** –ë–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ "–∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –∫–∞–∫ –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑" - –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è —Ç–µ–ø–µ—Ä—å —Å—Ç–∞–±–∏–ª–µ–Ω –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ Docker –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.

---
*–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: 2025-11-17*  
*–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ: ubuntu@192.168.1.125*